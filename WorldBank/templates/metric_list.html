{% extends 'base.html' %}

{% block head %}
<!--    <link rel=stylesheet href=css/bootstrap.min.css>-->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <style>
        html, body, .main_sec, .main-card {
            height: 100%;
        }
        .main_sec table thead tr th {
            background: #02294e;
            color: #fff;
        }
        .main_sec table {
            border: 1px solid #f1f1f1;
        }
        .main_sec table tbody tr td {
            border-bottom: 1px solid #f1f1f1;
        }
        /* .main_sec table tbody tr:last-child td {
            /* border-bottom: 1px solid transparent;
        } */
        label {
            font-size: 14px;
            font-weight: 500;
        }
        .form-control {
            font-size: 14px;
            color: #02294e;
            border: 1px solid #02294e;
        }
        select {
            min-width: 100px;
        }
        input {
            max-width: 150px;
        }
        .table-hover tbody tr:hover {
            background-color: #d1f3ff;
        }
        .btn-dark {
            background-color: #02294e;
        }
        .card-header {
            height: 55px;
        }
        .card-footer {
            height: 88px;
        }
        .card-body {
            height: calc( 100% - 143px);
            overflow: auto;
        }
        .card-footer input {
            width: 170px;
            text-align: center;
            max-width: unset;
        }
    </style>
{% endblock %}

{% block body %}
    <div id="page" class=main_sec>
        <div class="main-card mb-3 card">
            <div class="card-header d-flex align-items-center justify-content-between">
                <div class="text-capitalize fw-normal">World bank data on education
                </div>
                <div class="d-flex justify-content-end">
                    <div class="d-flex align-items-center">
                        <label class="">Select&nbsp;Year: </label>
                        <select onchange=foo(this) id="select_years" class="form-control bg-transparent mx-2">
                            <option selected="2004" value="2004">2004</option>
                            <option value="2005">2005</option>
                            <option value="2006">2006</option>
                            <option value="2007">2007</option>
                            <option value="2008">2008</option>
                            <option value="2009">2009</option>
                            <option value="2010">2010</option>
                            <option value="2011">2011</option>
                            <option value="2012">2012</option>
                            <option value="2013">2013</option>
                        </select>
                    </div>
                    <div class="d-flex align-items-center">
                        <label class="">Sort&nbsp;By: </label>
                        <select id="select_order" class="form-control bg-transparent mx-2">
                            <option selected="" value="asce">Ascending</option>
                            <option value="desc">Descending</option>
                        </select>
                    </div>
                    <div class="d-flex align-items-center">
                        <label class="">Metric&nbsp;Id: </label>
                        <input id="metric_input" type="text" placeholder="Enter Metric Id" class="form-control bg-transparent mx-2">
                    </div>
                    <div class="d-flex align-items-center">
                        <label class="">Country&nbsp;Code: </label>
                        <input id="country_input" type="text" placeholder="Enter Country Code" class="form-control bg-transparent mx-2">
                    </div>
                    <div class="d-flex align-items-center mx-2">
                        <button class="btn-pill shadow btn btn-dark fw-bold" onclick="metric_filter_data();">Filter</button>
                    </div>
                </div>
            </div>
            <div class="row mx-0 card-body">
                <div class="col-md-11 mx-auto table-responsive p-3">
                    <table class="w-100 bg-light align-middle text-truncate mb-0 table table-borderless table-hover">
                        <thead>
                            <tr>
                                <th class="text-center">Metric Id</th>
                                <th class="text-center">Country Code</th>
                                <th class="text-center">2006</th>
                                <th class="text-center">2007</th>
                                <th class="text-center">2004</th>
                                <th class="text-center">2005</th>
                                <th class="text-center">2008</th>
                                <th class="text-center">2009</th>
                                <th class="text-center">2011</th>
                                <th class="text-center">2010</th>
                                <th class="text-center">2013</th>
                                <th class="text-center">2012</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for m in metric_obj %}
                                <tr>
                                    <td class="text-center text-muted" style="width: 80px;">{{m.metric_id}}</td>
                                    <td class="text-center">{{m.country_code}}</td>
                                    <td class="text-center">{{m.record_2006}}</td>
                                    <td class="text-center">{{m.record_2007}}</td>
                                    <td class="text-center">{{m.record_2004}}</td>
                                    <td class="text-center">{{m.record_2005}}</td>
                                    <td class="text-center">{{m.record_2008}}</td>
                                    <td class="text-center">{{m.record_2009}}</td>
                                    <td class="text-center">{{m.record_2011}}</td>
                                    <td class="text-center">{{m.record_2010}}</td>
                                    <td class="text-center">{{m.record_2013}}</td>
                                    <td class="text-center">{{m.record_2012}}</td>
                                </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
            <div class="d-block p-4 text-center card-footer">
                <div class="d-flex align-items-center justify-content-between">
                    <div class="d-flex align-items-center">
                        <label class="btn-pill shadow btn btn-dark fw-bold">Count</label>
                        <input id="count_val_id" class="form-control bg-transparent mx-2" type="text" value={{aggregate_obj.record_count}} disabled>
                        <label class="btn-pill shadow btn btn-dark fw-bold">Sum</label>
                        <input id="sum_val_id" class="form-control bg-transparent mx-2" type="text" value={{aggregate_obj.record_sum}} disabled>
                        <label class="btn-pill shadow btn btn-dark fw-bold">Avg</label>
                        <input id="avg_val_id" class="form-control bg-transparent mx-2" type="text" value={{aggregate_obj.record_avg}} disabled>
                        <label class="btn-pill shadow btn btn-dark fw-bold">Max</label>
                        <input id="max_val_id" class="form-control bg-transparent mx-2" type="text" value={{aggregate_obj.record_max}} disabled>
                        <label class="btn-pill shadow btn btn-dark fw-bold">Min</label>
                        <input id="min_val_id" class="form-control bg-transparent mx-2" type="text" value={{aggregate_obj.record_min}} disabled>
                    </div>
                </div>
            </div>
        </div>
    </div>


    <script>


        function metric_filter_data(){
            var metric_id = document.getElementById("metric_input").value;
            var country_code = document.getElementById("country_input").value;
            var order_type = document.getElementById("select_order").value;
            var record_year = document.getElementById("select_years").value;

            $.ajax({
                    data: {'metric_id': metric_id,'country_code': country_code,
                            'order_type': order_type, 'record_year': record_year,
                          },
                    url: "http://127.0.0.1:8000/",
                    // on success
                    success: function(response){
                      $("#page").html(response);
                    },
            });
        }
    </script>
{% endblock %}

